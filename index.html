<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Eid Mubarak: Family & Feast</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }

        #game-container {
            width: 100%;
            height: 100%;
            max-width: 480px;
            max-height: 800px;
            margin: 0 auto;
            background: #f7f7f7;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.3);
        }

        /* Header */
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: relative;
            z-index: 10;
        }

        .player-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 18px;
        }

        /* Main Game Area */
        #game-area {
            height: calc(100% - 140px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 20px;
        }

        /* Navigation */
        #nav-menu {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #666;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 24px;
            display: block;
            margin-bottom: 5px;
        }

        .nav-label {
            font-size: 12px;
            font-weight: 600;
        }

        /* Screens */
        .screen {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .card:active {
            transform: scale(0.98);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .card-subtitle {
            color: #666;
            font-size: 14px;
            margin-top: 5px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            box-shadow: none;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        /* Progress Bars */
        .progress-bar {
            background: #e0e0e0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Mini Games */
        .mini-game {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .ingredient-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .ingredient-item {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ingredient-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .ingredient-icon {
            font-size: 30px;
            margin-bottom: 5px;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            text-align: center;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 15px;
            color: #333;
        }

        .reward-icon {
            font-size: 60px;
            margin: 20px 0;
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        /* Character Cards */
        .character-card {
            display: flex;
            align-items: center;
            gap: 15px;
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .character-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
        }

        .character-info {
            flex: 1;
        }

        .character-name {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .relationship-bar {
            display: flex;
            gap: 3px;
            margin-top: 5px;
        }

        .heart {
            width: 15px;
            height: 15px;
            background: #e0e0e0;
            mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'%3E%3Cpath d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z' fill='currentColor'/%3E%3C/svg%3E") center/contain no-repeat;
            -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none'%3E%3Cpath d='M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z' fill='currentColor'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        .heart.filled {
            background: #ff4757;
        }

        /* Animations */
        .float-up {
            animation: floatUp 2s ease-out;
            position: absolute;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }

        /* Responsive */
        @media (max-width: 480px) {
            #game-container {
                max-width: 100%;
                max-height: 100%;
                box-shadow: none;
            }
        }

        /* Loading Screen */
        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 1000;
        }

        .loading-icon {
            font-size: 80px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }

        .loading-text {
            font-size: 24px;
            font-weight: 600;
            margin-top: 20px;
        }

        /* Tutorial Overlay */
        .tutorial-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 90;
        }

        .tutorial-highlight {
            background: white;
            padding: 20px;
            border-radius: 15px;
            position: absolute;
            max-width: 80%;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .tutorial-arrow {
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Loading Screen -->
        <div id="loading-screen">
            <div class="loading-icon">üåô</div>
            <div class="loading-text">Eid Mubarak</div>
            <div style="margin-top: 10px; opacity: 0.8;">Loading your celebration...</div>
        </div>

        <!-- Header -->
        <div id="header">
            <div class="player-info">
                <div class="stat-item">
                    <span class="stat-icon">‚≠ê</span>
                    <span id="blessing-points">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üéÅ</span>
                    <span id="gifts-count">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-icon">üçΩÔ∏è</span>
                    <span id="dishes-count">0</span>
                </div>
            </div>
            <div class="stat-item">
                <span class="stat-icon">‚ö°</span>
                <span id="energy">100</span>
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area">
            <!-- Home Screen -->
            <div id="home-screen" class="screen active">
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Welcome to Eid Preparations!</h2>
                    </div>
                    <p class="card-subtitle">Help your family prepare for the perfect Eid celebration</p>
                    <div style="margin-top: 20px;">
                        <h3 style="margin-bottom: 10px;">Today's Tasks:</h3>
                        <div id="daily-tasks"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Quick Actions</h3>
                    </div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button class="btn btn-small" onclick="game.startCooking()">üç≥ Cook Dish</button>
                        <button class="btn btn-small" onclick="game.craftGift()">üéÅ Make Gift</button>
                        <button class="btn btn-small" onclick="game.visitFamily()">üë®‚Äçüë©‚Äçüëß Visit Family</button>
                        <button class="btn btn-small" onclick="game.collectResources()">üì¶ Gather Items</button>
                    </div>
                </div>

                <div class="card">
                    <h3 class="card-title">Story Progress</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="story-progress" style="width: 0%"></div>
                    </div>
                    <p class="card-subtitle" id="story-text">Chapter 1: First Eid Preparations</p>
                </div>
            </div>

            <!-- Kitchen Screen -->
            <div id="kitchen-screen" class="screen">
                <div class="card">
                    <h2 class="card-title">üç≥ Kitchen</h2>
                    <p class="card-subtitle">Master traditional Eid recipes</p>
                </div>

                <div id="recipe-list"></div>
            </div>

            <!-- Gifts Screen -->
            <div id="gifts-screen" class="screen">
                <div class="card">
                    <h2 class="card-title">üéÅ Gift Workshop</h2>
                    <p class="card-subtitle">Create meaningful gifts for loved ones</p>
                </div>

                <div id="gift-list"></div>
            </div>

            <!-- Family Screen -->
            <div id="family-screen" class="screen">
                <div class="card">
                    <h2 class="card-title">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family & Friends</h2>
                    <p class="card-subtitle">Build relationships and spread joy</p>
                </div>

                <div id="family-list"></div>
            </div>

            <!-- Community Screen -->
            <div id="community-screen" class="screen">
                <div class="card">
                    <h2 class="card-title">üïå Community Events</h2>
                    <p class="card-subtitle">Organize and participate in celebrations</p>
                </div>

                <div id="event-list"></div>
            </div>
        </div>

        <!-- Navigation Menu -->
        <div id="nav-menu">
            <div class="nav-item active" onclick="game.switchScreen('home')">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" onclick="game.switchScreen('kitchen')">
                <span class="nav-icon">üç≥</span>
                <span class="nav-label">Kitchen</span>
            </div>
            <div class="nav-item" onclick="game.switchScreen('gifts')">
                <span class="nav-icon">üéÅ</span>
                <span class="nav-label">Gifts</span>
            </div>
            <div class="nav-item" onclick="game.switchScreen('family')">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Family</span>
            </div>
            <div class="nav-item" onclick="game.switchScreen('community')">
                <span class="nav-icon">üïå</span>
                <span class="nav-label">Community</span>
            </div>
        </div>

        <!-- Modals -->
        <div id="reward-modal" class="modal">
            <div class="modal-content">
                <h2 class="modal-title" id="reward-title">Reward!</h2>
                <div class="reward-icon" id="reward-icon">‚≠ê</div>
                <p id="reward-text">You earned something special!</p>
                <button class="btn" onclick="game.closeModal()">Collect</button>
            </div>
        </div>

        <div id="cooking-modal" class="modal">
            <div class="modal-content">
                <h2 class="modal-title">Cooking Mini-Game</h2>
                <div id="cooking-game"></div>
            </div>
        </div>

        <!-- Tutorial Overlay -->
        <div id="tutorial-overlay" class="tutorial-overlay">
            <div class="tutorial-highlight">
                <h3 id="tutorial-title">Welcome!</h3>
                <p id="tutorial-text">Let's learn how to play</p>
                <button class="btn" onclick="game.nextTutorial()">Next</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        const gameState = {
            player: {
                level: 1,
                experience: 0,
                blessingPoints: 0,
                energy: 100,
                maxEnergy: 100,
                inventory: {
                    ingredients: {
                        dates: 5,
                        flour: 3,
                        sugar: 3,
                        milk: 2,
                        eggs: 2,
                        butter: 2,
                        spices: 1
                    },
                    craftingMaterials: {
                        fabric: 2,
                        ribbon: 3,
                        paper: 5,
                        decorations: 2
                    }
                },
                statistics: {
                    giftsGiven: 0,
                    dishesMade: 0,
                    eventsHosted: 0,
                    peopleHelped: 0
                }
            },
            recipes: [
                { id: 1, name: "Date Cookies", emoji: "üç™", difficulty: 1, unlocked: true, ingredients: { dates: 2, flour: 1, butter: 1 }, reward: 25 },
                { id: 2, name: "Baklava", emoji: "ü•Æ", difficulty: 2, unlocked: false, ingredients: { flour: 2, butter: 2, sugar: 2 }, reward: 50 },
                { id: 3, name: "Biryani", emoji: "üçõ", difficulty: 3, unlocked: false, ingredients: { spices: 2, flour: 1, milk: 1 }, reward: 100 }
            ],
            gifts: [
                { id: 1, name: "Eid Card", emoji: "üíå", difficulty: 1, unlocked: true, materials: { paper: 1, decorations: 1 }, reward: 20 },
                { id: 2, name: "Prayer Mat", emoji: "üïã", difficulty: 2, unlocked: false, materials: { fabric: 2, decorations: 1 }, reward: 40 },
                { id: 3, name: "Decorative Lantern", emoji: "üèÆ", difficulty: 3, unlocked: false, materials: { paper: 2, decorations: 2 }, reward: 60 }
            ],
            family: [
                { id: 1, name: "Mother", emoji: "üë©", relationship: 3, maxRelationship: 5, requests: ["Date Cookies", "Eid Card"] },
                { id: 2, name: "Father", emoji: "üë®", relationship: 2, maxRelationship: 5, requests: ["Biryani", "Prayer Mat"] },
                { id: 3, name: "Sister", emoji: "üëß", relationship: 2, maxRelationship: 5, requests: ["Baklava", "Decorative Lantern"] },
                { id: 4, name: "Brother", emoji: "üë¶", relationship: 1, maxRelationship: 5, requests: ["Date Cookies", "Eid Card"] }
            ],
            events: [
                { id: 1, name: "Family Iftar", emoji: "üåô", participants: 5, requirement: { dishes: 2, gifts: 1 }, reward: 200, unlocked: true },
                { id: 2, name: "Community Feast", emoji: "üéâ", participants: 20, requirement: { dishes: 5, gifts: 3 }, reward: 500, unlocked: false }
            ],
            dailyTasks: [
                { id: 1, task: "Make 2 dishes", progress: 0, target: 2, reward: 50, completed: false },
                { id: 2, task: "Give 3 gifts", progress: 0, target: 3, reward: 40, completed: false },
                { id: 3, task: "Earn 100 blessing points", progress: 0, target: 100, reward: 30, completed: false }
            ],
            currentScreen: 'home',
            tutorialStep: 0,
            soundEnabled: true
        };

        // Game Controller
        const game = {
            init() {
                this.loadGame();
                this.updateUI();
                this.startEnergyRegeneration();
                
                setTimeout(() => {
                    document.getElementById('loading-screen').style.display = 'none';
                    if (gameState.tutorialStep === 0) {
                        this.startTutorial();
                    }
                }, 2000);

                this.renderDailyTasks();
                this.renderRecipes();
                this.renderGifts();
                this.renderFamily();
                this.renderEvents();
            },

            updateUI() {
                document.getElementById('blessing-points').textContent = gameState.player.blessingPoints;
                document.getElementById('gifts-count').textContent = gameState.player.statistics.giftsGiven;
                document.getElementById('dishes-count').textContent = gameState.player.statistics.dishesMade;
                document.getElementById('energy').textContent = gameState.player.energy;
                
                const storyProgress = Math.min((gameState.player.level - 1) * 10, 100);
                document.getElementById('story-progress').style.width = `${storyProgress}%`;
            },

            switchScreen(screen) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                document.getElementById(`${screen}-screen`).classList.add('active');
                event.currentTarget.classList.add('active');
                
                gameState.currentScreen = screen;
                this.playSound('click');
            },

            startCooking() {
                if (gameState.player.energy < 10) {
                    this.showReward('‚ùå', 'Not Enough Energy!', 'You need at least 10 energy to cook');
                    return;
                }

                const availableRecipes = gameState.recipes.filter(r => r.unlocked && this.hasIngredients(r.ingredients));
                if (availableRecipes.length === 0) {
                    this.showReward('üì¶', 'Need Ingredients!', 'Collect more ingredients to cook');
                    return;
                }

                const recipe = availableRecipes[0];
                this.showCookingGame(recipe);
            },

            showCookingGame(recipe) {
                const modal = document.getElementById('cooking-modal');
                const gameArea = document.getElementById('cooking-game');
                
                gameArea.innerHTML = `
                    <h3>Making ${recipe.emoji} ${recipe.name}</h3>
                    <p>Select the ingredients in the correct order!</p>
                    <div class="ingredient-grid">
                        ${Object.keys(recipe.ingredients).map(ing => `
                            <div class="ingredient-item" data-ingredient="${ing}" onclick="game.selectIngredient('${ing}')">
                                <div class="ingredient-icon">${this.getIngredientEmoji(ing)}</div>
                                <div>${ing}</div>
                            </div>
                        `).join('')}
                    </div>
                    <button class="btn" onclick="game.completeCooking('${recipe.id}')">Cook!</button>
                    <button class="btn btn-secondary" onclick="game.closeModal()">Cancel</button>
                `;
                
                modal.classList.add('active');
                gameState.currentRecipe = recipe;
                gameState.selectedIngredients = [];
            },

            selectIngredient(ingredient) {
                const item = event.currentTarget;
                item.classList.toggle('selected');
                
                if (gameState.selectedIngredients.includes(ingredient)) {
                    gameState.selectedIngredients = gameState.selectedIngredients.filter(i => i !== ingredient);
                } else {
                    gameState.selectedIngredients.push(ingredient);
                }
                
                this.playSound('click');
            },

            completeCooking(recipeId) {
                const recipe = gameState.recipes.find(r => r.id == recipeId);
                
                // Deduct ingredients
                Object.entries(recipe.ingredients).forEach(([ing, amount]) => {
                    gameState.player.inventory.ingredients[ing] -= amount;
                });
                
                // Deduct energy
                gameState.player.energy -= 10;
                
                // Add rewards
                gameState.player.blessingPoints += recipe.reward;
                gameState.player.statistics.dishesMade++;
                gameState.player.experience += 10;
                
                // Update daily task
                const cookingTask = gameState.dailyTasks.find(t => t.id === 1);
                if (cookingTask && !cookingTask.completed) {
                    cookingTask.progress++;
                    if (cookingTask.progress >= cookingTask.target) {
                        cookingTask.completed = true;
                        gameState.player.blessingPoints += cookingTask.reward;
                    }
                }
                
                this.closeModal();
                this.showReward(recipe.emoji, `${recipe.name} Complete!`, `+${recipe.reward} Blessing Points`);
                this.updateUI();
                this.saveGame();
                
                // Check for level up
                if (gameState.player.experience >= gameState.player.level * 50) {
                    this.levelUp();
                }
            },

            craftGift() {
                if (gameState.player.energy < 5) {
                    this.showReward('‚ùå', 'Not Enough Energy!', 'You need at least 5 energy to craft');
                    return;
                }

                const availableGifts = gameState.gifts.filter(g => g.unlocked && this.hasMaterials(g.materials));
                if (availableGifts.length === 0) {
                    this.showReward('üì¶', 'Need Materials!', 'Collect more crafting materials');
                    return;
                }

                const gift = availableGifts[0];
                
                // Deduct materials
                Object.entries(gift.materials).forEach(([mat, amount]) => {
                    gameState.player.inventory.craftingMaterials[mat] -= amount;
                });
                
                // Deduct energy
                gameState.player.energy -= 5;
                
                // Add rewards
                gameState.player.blessingPoints += gift.reward;
                gameState.player.statistics.giftsGiven++;
                gameState.player.experience += 5;
                
                // Update daily task
                const giftTask = gameState.dailyTasks.find(t => t.id === 2);
                if (giftTask && !giftTask.completed) {
                    giftTask.progress++;
                    if (giftTask.progress >= giftTask.target) {
                        giftTask.completed = true;
                        gameState.player.blessingPoints += giftTask.reward;
                    }
                }
                
                this.showReward(gift.emoji, `${gift.name} Crafted!`, `+${gift.reward} Blessing Points`);
                this.updateUI();
                this.saveGame();
            },

            visitFamily() {
                if (gameState.player.energy < 5) {
                    this.showReward('‚ùå', 'Not Enough Energy!', 'You need at least 5 energy to visit');
                    return;
                }

                const familyMember = gameState.family[Math.floor(Math.random() * gameState.family.length)];
                
                if (familyMember.relationship < familyMember.maxRelationship) {
                    familyMember.relationship++;
                    gameState.player.energy -= 5;
                    gameState.player.blessingPoints += 10;
                    gameState.player.experience += 5;
                    
                    this.showReward(familyMember.emoji, `Visited ${familyMember.name}!`, '+10 Blessing Points\nRelationship increased!');
                    this.updateUI();
                    this.renderFamily();
                    this.saveGame();
                } else {
                    this.showReward('üíï', 'Max Relationship!', `Your relationship with ${familyMember.name} is already at maximum`);
                }
            },

            collectResources() {
                if (gameState.player.energy < 5) {
                    this.showReward('‚ùå', 'Not Enough Energy!', 'You need at least 5 energy to collect resources');
                    return;
                }

                const ingredients = ['dates', 'flour', 'sugar', 'milk', 'eggs', 'butter', 'spices'];
                const materials = ['fabric', 'ribbon', 'paper', 'decorations'];
                
                const randomIngredient = ingredients[Math.floor(Math.random() * ingredients.length)];
                const randomMaterial = materials[Math.floor(Math.random() * materials.length)];
                
                gameState.player.inventory.ingredients[randomIngredient] += 2;
                gameState.player.inventory.craftingMaterials[randomMaterial] += 1;
                gameState.player.energy -= 5;
                
                this.showReward('üì¶', 'Resources Collected!', `+2 ${randomIngredient}\n+1 ${randomMaterial}`);
                this.updateUI();
                this.saveGame();
            },

            levelUp() {
                gameState.player.level++;
                gameState.player.experience = 0;
                
                // Unlock new content
                if (gameState.player.level === 2) {
                    gameState.recipes[1].unlocked = true;
                    gameState.gifts[1].unlocked = true;
                }
                if (gameState.player.level === 3) {
                    gameState.recipes[2].unlocked = true;
                    gameState.gifts[2].unlocked = true;
                    gameState.events[1].unlocked = true;
                }
                
                this.showReward('üåü', 'Level Up!', `You reached Level ${gameState.player.level}!\nNew content unlocked!`);
                this.renderRecipes();
                this.renderGifts();
                this.renderEvents();
            },

            hasIngredients(required) {
                return Object.entries(required).every(([ing, amount]) => 
                    gameState.player.inventory.ingredients[ing] >= amount
                );
            },

            hasMaterials(required) {
                return Object.entries(required).every(([mat, amount]) => 
                    gameState.player.inventory.craftingMaterials[mat] >= amount
                );
            },

            getIngredientEmoji(ingredient) {
                const emojis = {
                    dates: 'üå¥',
                    flour: 'üåæ',
                    sugar: 'üçØ',
                    milk: 'ü•õ',
                    eggs: 'ü•ö',
                    butter: 'üßà',
                    spices: 'üå∂Ô∏è'
                };
                return emojis[ingredient] || 'üì¶';
            },

            renderDailyTasks() {
                const container = document.getElementById('daily-tasks');
                container.innerHTML = gameState.dailyTasks.map(task => `
                    <div style="margin-bottom: 10px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span>${task.completed ? '‚úÖ' : '‚≠ï'} ${task.task}</span>
                            <span style="color: #667eea; font-weight: 600;">+${task.reward} ‚≠ê</span>
                        </div>
                        <div class="progress-bar" style="height: 6px;">
                            <div class="progress-fill" style="width: ${(task.progress / task.target) * 100}%"></div>
                        </div>
                    </div>
                `).join('');
            },

            renderRecipes() {
                const container = document.getElementById('recipe-list');
                container.innerHTML = gameState.recipes.map(recipe => {
                    const canCook = recipe.unlocked && this.hasIngredients(recipe.ingredients);
                    return `
                        <div class="card ${!recipe.unlocked ? 'opacity-50' : ''}">
                            <div class="card-header">
                                <div>
                                    <span style="font-size: 30px;">${recipe.emoji}</span>
                                    <h3 class="card-title" style="margin-top: 10px;">${recipe.name}</h3>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #667eea; font-weight: 600;">+${recipe.reward} ‚≠ê</div>
                                    <div style="font-size: 12px; color: #999;">10 ‚ö°</div>
                                </div>
                            </div>
                            ${recipe.unlocked ? `
                                <div style="margin-top: 10px;">
                                    <p style="font-size: 14px; color: #666;">Ingredients needed:</p>
                                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                                        ${Object.entries(recipe.ingredients).map(([ing, amt]) => `
                                            <span style="background: #f0f0f0; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                                                ${this.getIngredientEmoji(ing)} ${amt}
                                            </span>
                                        `).join('')}
                                    </div>
                                    <button class="btn btn-small" style="margin-top: 15px; width: 100%;" 
                                            onclick="game.showCookingGame(gameState.recipes[${gameState.recipes.indexOf(recipe)}])"
                                            ${!canCook ? 'disabled style="opacity: 0.5;"' : ''}>
                                        ${canCook ? 'Cook Now' : 'Need Ingredients'}
                                    </button>
                                </div>
                            ` : '<p style="text-align: center; color: #999; margin-top: 10px;">üîí Unlock at Level ' + (recipe.difficulty + 1) + '</p>'}
                        </div>
                    `;
                }).join('');
            },

            renderGifts() {
                const container = document.getElementById('gift-list');
                container.innerHTML = gameState.gifts.map(gift => {
                    const canCraft = gift.unlocked && this.hasMaterials(gift.materials);
                    return `
                        <div class="card ${!gift.unlocked ? 'opacity-50' : ''}">
                            <div class="card-header">
                                <div>
                                    <span style="font-size: 30px;">${gift.emoji}</span>
                                    <h3 class="card-title" style="margin-top: 10px;">${gift.name}</h3>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #667eea; font-weight: 600;">+${gift.reward} ‚≠ê</div>
                                    <div style="font-size: 12px; color: #999;">5 ‚ö°</div>
                                </div>
                            </div>
                            ${gift.unlocked ? `
                                <div style="margin-top: 10px;">
                                    <p style="font-size: 14px; color: #666;">Materials needed:</p>
                                    <div style="display: flex; gap: 10px; margin-top: 5px;">
                                        ${Object.entries(gift.materials).map(([mat, amt]) => `
                                            <span style="background: #f0f0f0; padding: 5px 10px; border-radius: 15px; font-size: 12px;">
                                                ${mat} x${amt}
                                            </span>
                                        `).join('')}
                                    </div>
                                    <button class="btn btn-small" style="margin-top: 15px; width: 100%;" 
                                            onclick="game.craftGift()"
                                            ${!canCraft ? 'disabled style="opacity: 0.5;"' : ''}>
                                        ${canCraft ? 'Craft Gift' : 'Need Materials'}
                                    </button>
                                </div>
                            ` : '<p style="text-align: center; color: #999; margin-top: 10px;">üîí Unlock at Level ' + (gift.difficulty + 1) + '</p>'}
                        </div>
                    `;
                }).join('');
            },

            renderFamily() {
                const container = document.getElementById('family-list');
                container.innerHTML = gameState.family.map(member => `
                    <div class="character-card">
                        <div class="character-avatar">${member.emoji}</div>
                        <div class="character-info">
                            <div class="character-name">${member.name}</div>
                            <div class="relationship-bar">
                                ${Array.from({length: member.maxRelationship}, (_, i) => 
                                    `<div class="heart ${i < member.relationship ? 'filled' : ''}"></div>`
                                ).join('')}
                            </div>
                            <div style="font-size: 12px; color: #666; margin-top: 5px;">
                                Wants: ${member.requests.join(', ')}
                            </div>
                        </div>
                        <button class="btn btn-small" onclick="game.visitFamily()">Visit</button>
                    </div>
                `).join('');
            },

            renderEvents() {
                const container = document.getElementById('event-list');
                container.innerHTML = gameState.events.map(event => {
                    const canHost = event.unlocked && 
                                   gameState.player.statistics.dishesMade >= event.requirement.dishes &&
                                   gameState.player.statistics.giftsGiven >= event.requirement.gifts;
                    return `
                        <div class="card ${!event.unlocked ? 'opacity-50' : ''}">
                            <div class="card-header">
                                <div>
                                    <span style="font-size: 30px;">${event.emoji}</span>
                                    <h3 class="card-title" style="margin-top: 10px;">${event.name}</h3>
                                    <p class="card-subtitle">${event.participants} participants</p>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: #667eea; font-weight: 600;">+${event.reward} ‚≠ê</div>
                                </div>
                            </div>
                            ${event.unlocked ? `
                                <div style="margin-top: 10px;">
                                    <p style="font-size: 14px; color: #666;">Requirements:</p>
                                    <div style="margin-top: 5px;">
                                        <p>üçΩÔ∏è ${event.requirement.dishes} dishes prepared</p>
                                        <p>üéÅ ${event.requirement.gifts} gifts given</p>
                                    </div>
                                    <button class="btn btn-small" style="margin-top: 15px; width: 100%;" 
                                            onclick="game.hostEvent(${event.id})"
                                            ${!canHost ? 'disabled style="opacity: 0.5;"' : ''}>
                                        ${canHost ? 'Host Event' : 'Not Ready'}
                                    </button>
                                </div>
                            ` : '<p style="text-align: center; color: #999; margin-top: 10px;">üîí Unlock at Level 3</p>'}
                        </div>
                    `;
                }).join('');
            },

            hostEvent(eventId) {
                const event = gameState.events.find(e => e.id === eventId);
                
                gameState.player.blessingPoints += event.reward;
                gameState.player.statistics.eventsHosted++;
                gameState.player.experience += 50;
                
                this.showReward(event.emoji, `${event.name} Success!`, `+${event.reward} Blessing Points\nThe community loved it!`);
                this.updateUI();
                this.saveGame();
                
                if (gameState.player.experience >= gameState.player.level * 50) {
                    this.levelUp();
                }
            },

            showReward(icon, title, text) {
                document.getElementById('reward-icon').textContent = icon;
                document.getElementById('reward-title').textContent = title;
                document.getElementById('reward-text').textContent = text;
                document.getElementById('reward-modal').classList.add('active');
                
                this.playSound('success');
                
                // Update blessing points task
                const blessingTask = gameState.dailyTasks.find(t => t.id === 3);
                if (blessingTask && !blessingTask.completed) {
                    blessingTask.progress = gameState.player.blessingPoints;
                    if (blessingTask.progress >= blessingTask.target) {
                        blessingTask.completed = true;
                        gameState.player.blessingPoints += blessingTask.reward;
                    }
                }
                
                this.renderDailyTasks();
            },

            closeModal() {
                document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
            },

            startEnergyRegeneration() {
                setInterval(() => {
                    if (gameState.player.energy < gameState.player.maxEnergy) {
                        gameState.player.energy = Math.min(gameState.player.energy + 1, gameState.player.maxEnergy);
                        this.updateUI();
                    }
                }, 30000); // Regenerate 1 energy every 30 seconds
            },

            startTutorial() {
                const tutorials = [
                    { title: "Welcome to Eid Preparations!", text: "Help your family prepare for the perfect Eid celebration!" },
                    { title: "Earn Blessing Points", text: "Complete tasks, cook dishes, and give gifts to earn blessing points" },
                    { title: "Manage Your Energy", text: "Actions cost energy. It regenerates over time!" },
                    { title: "Build Relationships", text: "Visit family members and fulfill their requests to strengthen bonds" },
                    { title: "Let's Begin!", text: "Start with simple tasks and work your way up to hosting big events!" }
                ];

                if (gameState.tutorialStep < tutorials.length) {
                    const tutorial = tutorials[gameState.tutorialStep];
                    document.getElementById('tutorial-title').textContent = tutorial.title;
                    document.getElementById('tutorial-text').textContent = tutorial.text;
                    document.getElementById('tutorial-overlay').style.display = 'flex';
                }
            },

            nextTutorial() {
                gameState.tutorialStep++;
                if (gameState.tutorialStep >= 5) {
                    document.getElementById('tutorial-overlay').style.display = 'none';
                    this.saveGame();
                } else {
                    this.startTutorial();
                }
            },

            playSound(type) {
                if (!gameState.soundEnabled) return;
                
                // Create audio context on user interaction
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                switch(type) {
                    case 'click':
                        oscillator.frequency.value = 800;
                        gainNode.gain.value = 0.1;
                        oscillator.start();
                        oscillator.stop(this.audioContext.currentTime + 0.05);
                        break;
                    case 'success':
                        oscillator.frequency.value = 600;
                        gainNode.gain.value = 0.2;
                        oscillator.start();
                        oscillator.frequency.linearRampToValueAtTime(800, this.audioContext.currentTime + 0.1);
                        oscillator.stop(this.audioContext.currentTime + 0.2);
                        break;
                }
            },

            saveGame() {
                const saveData = {
                    gameState: gameState,
                    timestamp: Date.now()
                };
                // In a real implementation, this would save to a backend
                // For now, we'll just log it
                console.log('Game saved:', saveData);
            },

            loadGame() {
                // In a real implementation, this would load from a backend
                // For now, we'll use the default gameState
                console.log('Game loaded');
            }
        };

        // Initialize game when page loads
        window.addEventListener('load', () => {
            game.init();
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            const container = document.getElementById('game-container');
            if (window.innerWidth <= 480) {
                container.style.width = '100%';
                container.style.height = '100%';
            }
        });

        // Prevent scrolling on mobile
        document.addEventListener('touchmove', (e) => {
            if (e.target.closest('#game-area')) return;
            e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
